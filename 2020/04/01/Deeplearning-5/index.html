<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://hyeonji-ryu.github.io').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="해당 시리즈는 프로그래밍 언어 중 하나인 줄리아(Julia)로 딥러닝(Deep learning)을 구현하면서 원리를 설명합니다.">
<meta property="og:type" content="article">
<meta property="og:title" content="5. 인공신경망 구현 - 수학식 풀이">
<meta property="og:url" content="https://hyeonji-ryu.github.io/2020/04/01/Deeplearning-5/index.html">
<meta property="og:site_name" content="AI &amp; ML">
<meta property="og:description" content="해당 시리즈는 프로그래밍 언어 중 하나인 줄리아(Julia)로 딥러닝(Deep learning)을 구현하면서 원리를 설명합니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://hyeonji-ryu.github.io/images/36.png">
<meta property="og:image" content="https://hyeonji-ryu.github.io/images/37.png">
<meta property="article:published_time" content="2020-04-01T08:59:47.000Z">
<meta property="article:modified_time" content="2020-04-06T04:41:41.390Z">
<meta property="article:author" content="Hyeonji Ryu">
<meta property="article:tag" content="딥러닝">
<meta property="article:tag" content="머신러닝">
<meta property="article:tag" content="Deeplearning">
<meta property="article:tag" content="줄리아">
<meta property="article:tag" content="신경망">
<meta property="article:tag" content="순전파">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyeonji-ryu.github.io/images/36.png">

<link rel="canonical" href="https://hyeonji-ryu.github.io/2020/04/01/Deeplearning-5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>5. 인공신경망 구현 - 수학식 풀이 | AI & ML</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AI & ML</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Julia, Python, R</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>홈</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>태그</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>카테고리</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>아카이브</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Hyeonji-Ryu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="ko">
    <link itemprop="mainEntityOfPage" href="https://hyeonji-ryu.github.io/2020/04/01/Deeplearning-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hyeonji Ryu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI & ML">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          5. 인공신경망 구현 - 수학식 풀이
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">작성일</span>

              <time title="Post created: 2020-04-01 17:59:47" itemprop="dateCreated datePublished" datetime="2020-04-01T17:59:47+09:00">2020-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Updated at: 2020-04-06 13:41:41" itemprop="dateModified" datetime="2020-04-06T13:41:41+09:00">2020-04-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-learning-with-Julia/" itemprop="url" rel="index">
                    <span itemprop="name">Deep learning with Julia</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>해당 시리즈는 프로그래밍 언어 중 하나인 줄리아(Julia)로 딥러닝(Deep learning)을 구현하면서 원리를 설명합니다.<br><a id="more"></a></p>
<h2 id="인공신경망이란"><a href="#인공신경망이란" class="headerlink" title="인공신경망이란"></a>인공신경망이란</h2><script type="math/tex; mode=display">Layer=(X*W)+B</script><p>위 수식은 각 층을 계산하는 식이며, 입력 데이터의 값들인 배열 $X$에 가중치 $W$를 곱한 후 편향 $B$를 더한다. 이 식은 신경망이 작동하는 방식에서 가져온 알고리즘이다. 생물학에서의 신경망은 수많은 뉴런(신경 세포)이 연결되어 있으며, 이들은 전기 신호를 전달한다. 각각의 뉴런들은 수상돌기를 통해 들어오는 전기 신호를 받고 세포체에서 종합한 후 축삭돌기를 통해 전기 신호를 다른 뉴런으로 내보낸다. 이때 축삭돌기 끝 부분인 시냅스에서 전기 신호에 따라 신경전달물질을 분비하여 다른 뉴런의 시냅스로 전달하는데 이런 과정을 신경이라고 부르는 것이다.</p>
<p><img src="\../images/36.png" alt="신경 세포 구조"></p>
<p>그렇다면 뉴런들은 왜 전기 신호들을 전달하는 것일까? 이유는 간단하다. 우리 몸에서 필요한 생활 기능들을 ‘적절’하게 조절하기 위해서이다. 뉴런은 수상돌기에서 전기 신호를 생산하라는 흥분성 신호와 전기 신호를 생산하지 말라는 억제성 신호를 받아들인다. 그후 세포체에서 이를 종합하여 다른 뉴런으로 해당 전기 신호를 보낼지 말지 결정한다. 이런 뉴런의 원리를 바탕으로 살펴봤을 때 가중치를 곱하는 것은 뉴런에서 각각의 고유한 흥분성과 억제성 신호를 받아들이는 과정을 표현했다고 볼 수 있다.<br>물론 실제 생물학에서의 뉴런은 세포체에서 전기 신호를 보내거나(1), 보내지 않거나(0)라는 계단 함수의 개념으로 작동한다는 차이점이 있지만, 가중치의 원리는 동일하다. 또한 편향은 뉴런이 가지고 있는 ‘임계값’을 표현한 것이다. 세포체는 받은 전기 신호가 어느 임계값 이상이 되어야 전기 신호를 내보내는 데, 이를 나타낸 것이다.</p>
<p>따라서 인공신경망의 원리를 한번에 설명한다면, 입력 신호에 가중치를 곱하면서 적절한 전기 신호로 변환하여 받은 후, 편향(임계값)이 넘으면 전기 신호를 출력한다고 정리된다. 4층으로 구성된 인공신경망 계산 과정을 도식화하면 다음과 같다.</p>
<p><img src="\../images/37.png" alt="인공신경망 계산 과정"></p>
<h2 id="인공신경망-수학식-풀이"><a href="#인공신경망-수학식-풀이" class="headerlink" title="인공신경망 수학식 풀이"></a>인공신경망 수학식 풀이</h2><p>인공신경망을 코드로 구현하기에 앞서 수학식으로 풀이해보려고 한다. 이 과정이 필요한 이유는 컴퓨터가 신경망 모델을 어떻게 진행하는지 명확히 파악하고, 이해해야 하기 때문이다. 따라서 위의 인공신경망 도식을 수식으로 풀이해보자. (참고로 위의 인공신경망 도식은 4층 신경망이다.)</p>
<script type="math/tex; mode=display">X:
\begin{bmatrix}
 x_1 & x_2 \\
 \end{bmatrix}\quad
W_1:
\begin{bmatrix}
 w1_{11} & w1_{12} \\
 w1_{21} & w1_{22} \\
 \end{bmatrix}\quad
W_2:
\begin{bmatrix}
 w2_{11} & w2_{12} & w2_{13}\\
 w2_{21} & w2_{22} & w2_{23}\\
 \end{bmatrix}</script><script type="math/tex; mode=display">B_1:
\begin{bmatrix}
b1_1 & b1_2
 \end{bmatrix}\quad
 B_2:
\begin{bmatrix}
 b2_1 & b2_2 & b2_3
 \end{bmatrix}</script><p>먼저 입력값인 $X$와 가중치 $W_1, W_2$, 편향 $b_1, b_2$를 설정한다. 예시이기 때문에 입력층, 은닉층, 출력층의 노드 개수를 임의로 설정하였다. (실제로는 훨씬 많은 노드들이 사용된다.)</p>
<script type="math/tex; mode=display">Z1 = XW_1+B_1</script><script type="math/tex; mode=display">Z1=
\begin{bmatrix}
 x_1 & x_2 \\
 \end{bmatrix}
\times
\begin{bmatrix}
 w1_{11} & w1_{12} \\
 w1_{21} & w1_{22} \\
 \end{bmatrix}
+
\begin{bmatrix}
b1_1 & b1_2
 \end{bmatrix}\\</script><script type="math/tex; mode=display">=
\begin{bmatrix}
x_1w1_{11}+x_2w1_{21}+b1_1 & x_1w1_{12}+x_2w1_{22}+b1_2
\end{bmatrix}</script><p>먼저 입력값에 첫 번째 가중치인 $W_1$을 곱하고 첫 번째 편향인 $B_1$ 더한다. 입력값과 가중치, 편향 모두 배열이기에 이 계산은 배열 단위로 이루어진다. 즉, 행렬곱과 행렬덧셈이 사용되는 것이다. 이 과정은 입력값이 첫 번째 활성화 함수 $h(x)$로 넘어가기 전에 이루어진다.</p>
<script type="math/tex; mode=display">A1 = \cfrac{1}{1+e^{-Z1}}</script><script type="math/tex; mode=display">A1 =
\begin{bmatrix}
\cfrac{1}{1+e^{-Z1_1}} & \cfrac{1}{1+e^{-Z1_2}}
\end{bmatrix}</script><p>그 다음, 위의 $Z_1$을 활성화 함수에 대입하면 된다. 여기서 $Z_1$은 행렬인데 위의 수식을 $Z_1$의 요소에 각각 적용한다. 참고로 위 식에서 사용된 활성화 함수는 시그모이드 함수이다. 이 과정은 입력값이 첫 번째 은닉층에 도착한 것이다.</p>
<script type="math/tex; mode=display">Z2 = \bigg(\cfrac{1}{1+e^{-Z1)}}\bigg)\times W_2+b_2</script><script type="math/tex; mode=display">=
\begin{bmatrix}
\frac{w2_{11}}{1+e^{-Z1_1}}+\frac{w2_{21}}{1+e^{-Z1_2}}+b2_1 & \frac{w2_{12}}{1+e^{-Z1_1}}+\frac{w2_{22}}{1+e^{-Z1_2}}+b2_2 & \frac{w2_{13}}{1+e^{-Z1_1}}+\frac{w2_{23}}{1+e^{-Z1_2}}+b2_3
\end{bmatrix}</script><p>$A1$의 값은 행렬로 반환된다. $A1$을 다시 두 번째 은닉층으로 보내기 위해 두 번째 가중치인 $W_2$를 곱하고 두 번째 편향인 $b_2$를 더한다. 여기서도 행렬곱과 행렬덧셈이 사용된다. 행렬 단위로 계산되는 수식은 $Z1$과 동일하다.</p>
<script type="math/tex; mode=display">A2 = \cfrac{1}{1+e^{-Z2}}</script><script type="math/tex; mode=display">A2 =
\begin{bmatrix}
\cfrac{1}{1+e^{-Z2_1}} & \cfrac{1}{1+e^{-Z2_2}} & \cfrac{1}{1+e^{-Z2_3}}
\end{bmatrix}</script><p>두 번째 은닉층을 계산해야 한다. 가중치와 편향을 계산한 입력값을 다시 활성화 함수에 변수로 대입한다. 두 번째 은닉층의 활성화 함수도 시그모이드 함수를 사용하였다. 행렬 단위로 적용되는 수식은 $A1$과 동일하다.</p>
<script type="math/tex; mode=display">\hat{y_k}=\cfrac{e^{A2_k}}{\sum_{i=1}^n e^{A2_i}}</script><script type="math/tex; mode=display">\hat{y_k}=
\begin{bmatrix}
\cfrac{e^{A2_1}}{\sum_{i=1}^3 e^{A2_i}} & \cfrac{e^{A2_2}}{\sum_{i=1}^3 e^{A2_i}} & \cfrac{e^{A2_3}}{\sum_{i=1}^3 e^{A2_i}}
\end{bmatrix}</script><p>은닉층 계산 이후 마지막으로 출력층 활성화 함수인 소프트맥스 함수를 적용하여 예측값 $\hat{y}$을 얻었다.</p>
<p>위의 식을 토대로 우리는 예측값을 아래와 같은 식로 정의할 수 있다.</p>
<script type="math/tex; mode=display">\hat{y}=\sigma(h(h(XW_1+B_1)\times W_2+B_2))</script><p>위의 식을 살펴보면 $Z1$인 $XW_1+B_1$을 활성화 함수 $h(x)$에 대입하고, 활성화 함수의 결과 값을 다시 $Z2$의 입력값으로 받는다. 그렇게 $Z2$를 계산한 후 이를 다시 활성화 함수 $h(x)$에 대입한다. 그리고 마지막으로 출력층의 활성화 함수인 $\sigma(x)$에 대입하여 나온 값이 예측값 $\hat{y}$이다.</p>
<h2 id="인공신경망-학습-과정-수학식-풀이"><a href="#인공신경망-학습-과정-수학식-풀이" class="headerlink" title="인공신경망 학습 과정 수학식 풀이"></a>인공신경망 학습 과정 수학식 풀이</h2><p>위에서는 하나의 신경망을 예시로 들어 신경망이 어떻게 작동하는지 수학식으로 정리하였다. 지금부터는 인공신경망을 학습하는 과정이 어떻게 진행되는지 수학식으로 정리할 것이다. 인공신경망은 실제 사용되기 전에 훈련 데이터셋을 통해 학습시킨다. 여기서 ‘학습’이란 뜻은 신경망에 적절한 가중치와 편향을 찾는 과정을 의미한다. 우리는 <a href="https://hyeonji-ryu.github.io/2020/03/31/Deeplearning-4/#more">이전 글</a>에서 신경망 학습 알고리즘 중 하나인 경사하강법을 살펴보았다. 따라서 지금부터 경사하강법 알고리즘을 사용하여 위에서 풀이한 신경망 모델을 학습하는 과정을 수학식으로 풀이해보고자 한다.</p>
<p>(1) 먼저 학습을 하기 위해서는 학습 때 사용할 훈련 데이터셋과 무작위 값으로 구성된 가중치, 편향이 필요하다. 이를 준비한 후 예측값을 도출한다. 여기서 예측값은 $1\times 3$ 배열이다.</p>
<script type="math/tex; mode=display">\hat{y}=\sigma(h(h(XW_1+B_1)\times W_2+B_2))</script><p>(2) 도출된 예측값과 정답을 비교해야 한다. 손실 함수를 사용하여 오차값을 구한다. 이 예시에서는 손실 함수 중 하나인 ‘평균 제곱 오차’를 사용할 것이다.</p>
<script type="math/tex; mode=display">E=\frac{1}{n}\sum_{k=1}^n (\hat{y_k}-t_k)^2</script><p>(3) 기존의 오차값을 확인한 후, 오차값을 줄이기 위해 경사하강법 알고리즘을 사용한다. 경사하강법 알고리즘은 손실함수와 각각의 가중치와 편향들을 편미분하여 기울기를 구한 후, 기존의 가중치와 편향을 갱신하였다. 그렇다면 위의 손실함수 수식을 해체해야 한다. 가중치와 편향을 기준으로 편미분하기 위해서는 손실함수의 식에서 $W$와 $B$를 찾아야 하기 때문이다. 가중치와 편향이 배열인 경우에는 편미분이 각각의 요소 단위로 진행된다. 아래의 배열은 손실함수와 가중치가 어떻게 편미분이 진행되는지 예시를 보여준다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial W} =
\begin{bmatrix}
 \frac{\partial E}{\partial w_{11}} & \frac{\partial E}{\partial w_{12}} & \frac{\partial E}{\partial w_{13}}\\
 \frac{\partial E}{\partial w_{21}} & \frac{\partial E}{\partial w_{22}} & \frac{\partial E}{\partial w_{23}}\\
 \end{bmatrix}</script><p>지금부터 아래의 식에 사용되는 $w_{ij}$는 배열 형태인 $W$의 요소라는 점을 강조한다.</p>
<script type="math/tex; mode=display">E = \frac{1}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)^2 \\
= \frac{1}{3}\sum_{k=1}^3 ((\sigma(h(h(XW_1+B_1)\times W_2+B_2)))-t_k)^2</script><p>위의 식에서 $\hat{y}$는 여러 활성화 함수들의 합성 함수로 구성되어 있다. 보기만 해도 복잡하고 머리가 아프다. 하지만 $w<em>{ij}$를 기준으로 편미분하기 위해서는 위의 수식에서 $w</em>{ij}$와 같은 변수를 도출해야 한다. 하나의 변수를 정해서 식을 해체하는 방법이 더 빠를 것 같기에 우리는 $w_{11}$와 손실함수의 편미분 값을 찾아보자.</p>
<p><strong>목표: $\frac{\partial E}{\partial w1_{11}}$을 식으로 풀이하기</strong></p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}
= \frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)</script><p>$w1_{11}$는 $\hat{y_k}$ 안에 있기 때문에 위의 수식은 합성 함수의 미분이다. 따라서 식 내부에 있는 $(\hat{y_k}-t_k)$를 미분하여 곱해줘야 하는데, $t_k$의 경우 상수이기 때문에 미분했을 때 제거된다. 따라서 남은 $\hat{y_k}$는 $\sigma(A2_k)$와 같으므로 이어지는 식은 다음과 같다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}} = \frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k) \frac{\partial \hat{y}}{\partial w1_{11}}\\
=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k) \frac{\partial}{\partial w1_{11}}\sigma(A2_k)\\</script><p>출력층에서 사용된 소프트맥스는 확률로 해석하기 위한 기술적인 도구로 여러 개의 시그모이드값들을 모두 더한 후 각각의 시그모이드 값을 나눈 식이다. 여기서 잠깐 소프트맥스 함수를 미분하면 어떤 결과가 나오는지 확인하고 넘어가자.</p>
<script type="math/tex; mode=display">\frac{\partial\sigma(A2_k)}{\partial A2_k} = \frac{e^{A2_k}(\sum_{i=1}^3 e^{A2_i})-e^{A2_k}e^{A2_k}}{(\sum_{i=1}^3 e^{A2_i})^2}</script><script type="math/tex; mode=display">\quad \quad \quad  = \frac{e^{A2_k}\{(\sum_{i=1}^3 e^{A2_i})-e^{A2_k}\}}{(\sum_{i=1}^3 e^{A2_i})^2}</script><script type="math/tex; mode=display">\quad \quad \quad \quad \ \ = \frac{e^{A2_k}}{\sum_{i=1}^3 e^{A2_i}} \frac{(\sum_{i=1}^3 e^{A2_i})-e^{A2_k}}{\sum_{i=1}^3 e^{A2_i}}</script><script type="math/tex; mode=display">\quad \quad \quad \quad = \frac{e^{A2_k}}{\sum_{i=1}^3 e^{A2_i}}\Bigg(1-\frac{e^{A2_k}}{\sum_{i=1}^3 e^{A2_i}}\Bigg)</script><script type="math/tex; mode=display">\ \ = \sigma(A2_k)(1-\sigma(A2_k))</script><p>소프트맥스 함수 미분한 결과를 $\frac{\partial E}{\partial w1_{11}}$에 대입하면 아래와 같은 결과를 도출한다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\sigma(A2_k)(1-\sigma(A2_k))\frac{\partial A2_k}{\partial w1_{11}}</script><p>위 식에서 $\sigma(A2_k)$는 $\hat{y_k}$과 동일함으로 변경해줄 수 있다.</p>
<script type="math/tex; mode=display">\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\hat{y_k}(1-\hat{y_k})\frac{\partial A2_k}{\partial w1_{11}}</script><p>이제 $\frac{\partial A2<em>k}{\partial w1</em>{11}}$를 풀어야 한다. $A2_k$는 $Z2$이 값으로 주어진 시그모이드 함수이기 때문에 시그모이드를 미분하는 과정을 살펴보자.</p>
<script type="math/tex; mode=display">=\frac{\partial h(Z2_k)}{\partial Z2_k} = \frac{0\times(1+e^{-Z2_k})-1\times (0+e^{(-Z2_k)})(-1) }{(1+e^{-Z2_k})^2}</script><script type="math/tex; mode=display">\quad =\frac{e^{(-Z2_k)}}{(1+e^{-Z2_k})^2}= \frac{1+e^{(-Z2_k)}-1}{(1+e^{-Z2_k})^2}</script><script type="math/tex; mode=display">=\frac{(1+e^{(-Z2_k)})}{(1+e^{-Z2_k})^2}-\frac{1}{(1+e^{-Z2_k})^2}</script><script type="math/tex; mode=display">= \frac{1}{(1+e^{-Z2_k})}-\frac{1}{(1+e^{-Z2_k})^2}</script><script type="math/tex; mode=display">\quad = \frac{1}{(1+e^{-Z2_k})}\Big(1-\frac{1}{(1+e^{-Z2_k})}\Big)</script><script type="math/tex; mode=display">= h(Z2_k)(1-h(Z2_k))</script><p>따라서 시그모이드 함수를 미분한 결과를 $\frac{\partial E}{\partial w1_{11}}$에 대입하면 아래와 같은 결과를 도출한다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\ \hat{y_k}(1-\hat{y_k})\ h(Z2_k)(1-h(Z2_k)) \frac{\partial Z2_k}{\partial w1_{11}}</script><p>위 식에서 $h(Z2_k)$는 $A2_k$와 동일하기 때문에 변경할 수 있다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\ \hat{y_k}(1-\hat{y_k})\ A2_k(1-A2_k) \frac{\partial Z2_k}{\partial w1_{11}}</script><p>현재 미분해야 하는 $Z2$는 $A1_k\times W2+B2$이다.</p>
<script type="math/tex; mode=display">\frac{\partial Z2_k}{\partial w1_{11}} = \frac{\partial (A1_k\times W2+B2)}{\partial w1_{11}}</script><p>여기서 우리는 편미분을 진행하고 있기 때문에 $W1$을 포함하지 않는 $W2$와 $B2$는 상수이다. 따라서 미분 결과는 다음과 같다.</p>
<script type="math/tex; mode=display">\frac{\partial Z2_k}{\partial w1_{11}} = W2 \times \frac{\partial A1_k}{\partial w1_{11}}</script><p>미분대상을 가지고 있는 $A1_k$와 곱으로 연결된 $W2$는 상수로 남고 더하기로 연결된 $B$는 0이 되어 사라진다.</p>
<p>따라서 $\frac{\partial A1<em>k}{\partial w1</em>{11}}$만 계산하면 된다. $A1_k$는 시그모이드 함수의 결과 값이므로 $h(Z1_k)$과 동일하다.</p>
<script type="math/tex; mode=display">\frac{\partial Z2_k}{\partial w1_{11}} = W2 \times \frac{\partial A1_k}{\partial w1_{11}} = W2 \times \frac{\partial h(Z1_k)}{\partial w1_{11}}</script><p>앞서 시그모이드 함수의 미분을 확인했기 때문에 바로 $h(x)(1-h(x))$를 대입한다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\ \hat{y_k}(1-\hat{y_k})\ A2_k(1-A2_k) \times W2 \times  h(Z1_k)(1-h(Z1_k))\frac{\partial Z2_k}{\partial w1_{11}}</script><p>위 식에서 $h(Z1_k)$는 $A1_k$와 동일하기 때문에 변경할 수 있다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 (\hat{y_k}-t_k)\ \hat{y_k}(1-\hat{y_k})\ A2_k(1-A2_k) \times W2 \times  A1_k(1-A1_k))\frac{\partial Z1_k}{\partial w1_{11}}</script><p>현재 미분해야 하는 $Z1$는 $X\times W1+B1$이다. 해당 수식 안에 $w1<em>{11}$이 들어간 식은 배열의 첫 번째 요소인 $x_1w1</em>{11}+x<em>2w1</em>{21}+b1_1$ 이며, 나머지 값들은 전부 상수화된다.</p>
<script type="math/tex; mode=display">\frac{\partial Z1_k}{\partial w1_{11}} = \frac{\partial (x_1w1_{11}+x_2w1_{21}+b1_1)}{\partial w1_{11}}</script><p>위 편미분은 $w1<em>{11}$의 계수인 $x_1$만 남는다. 따라서 $\frac{\partial E}{\partial w1</em>{11}}$을 구하는 수식은 다음과 같다.</p>
<script type="math/tex; mode=display">\frac{\partial E}{\partial w1_{11}}=\frac{2}{3}\sum_{k=1}^3 \bigl\{ (\hat{y_k}-t_k)\ \hat{y_k}(1-\hat{y_k})\ A2_k(1-A2_k) \times W2 \times  A1_k(1-A1_k))\times x_1 \bigr\}</script><p>드디어 예시로 봤던 4층 신경망의 편미분을 수식으로 완성하였다. 위의 수식을 통해 $w1_{11}$의 편미분 값을 구할 수 있다.</p>
<p>(4) 마지막으로 해당 미분값에 학습률을 곱해 기존 가중치에서 뺀 후, 다시 할당해준다.</p>
<script type="math/tex; mode=display">w1_{11}=w1_{11}-\eta \frac{\partial E}{\partial w1_{11}}</script><p>(5) 새로운 가중치로 손실 함수 값을 도출한 후, 오차를 확인한다.</p>
<p>(6) 3~6번 과정을 일정 이상 반복한다.</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>아번 글에서는 신경망을 구현하기에 앞서 신경망의 원리와 학습 과정을 수학식으로 풀이하였다. 이 과정은 이해를 위함이며, 실제 코드는 약간 다르게 작동한다. 다음 글에서는 손글씨 인식하는 신경망을 구현하면서 코드로 작동하는 과정을 살펴볼 것이다.</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%EB%94%A5%EB%9F%AC%EB%8B%9D/" rel="tag"># 딥러닝</a>
              <a href="/tags/%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D/" rel="tag"># 머신러닝</a>
              <a href="/tags/Deeplearning/" rel="tag"># Deeplearning</a>
              <a href="/tags/%EC%A4%84%EB%A6%AC%EC%95%84/" rel="tag"># 줄리아</a>
              <a href="/tags/%EC%8B%A0%EA%B2%BD%EB%A7%9D/" rel="tag"># 신경망</a>
              <a href="/tags/%EC%88%9C%EC%A0%84%ED%8C%8C/" rel="tag"># 순전파</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/31/Deeplearning-4/" rel="prev" title="4. 경사하강법">
      <i class="fa fa-chevron-left"></i> 4. 경사하강법
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/04/Deeplearning-6/" rel="next" title="6. 신경망 구현 - 순전파">
      6. 신경망 구현 - 순전파 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          훑어보기
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#인공신경망이란"><span class="nav-number">1.</span> <span class="nav-text">인공신경망이란</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#인공신경망-수학식-풀이"><span class="nav-number">2.</span> <span class="nav-text">인공신경망 수학식 풀이</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#인공신경망-학습-과정-수학식-풀이"><span class="nav-number">3.</span> <span class="nav-text">인공신경망 학습 과정 수학식 풀이</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#결론"><span class="nav-number">4.</span> <span class="nav-text">결론</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hyeonji Ryu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hyeonji Ryu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

</body>
</html>
